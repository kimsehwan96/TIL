# Pod lifecycle

파드는 정의된 라이프사이클을 따릅니다. `Pending` 단계에서 시작해서, 기본 컨테이너중 하나 이상이 OK로 시작하면 `Running` 단계를 통과하고, 컨테이너가 실패로 종료되었는지 여부에 따라 `Succeeded` 또는 `Failed` 단계로 이동한다.

파드가 실행되는 동안 kubelet 은 오류를 처리하기 위해 컨테이너를 다시 시작할수도 있습니다. 쿠버네티스는 다양한 컨테이너 상태를 추적하고 파드를 다시 정상 상태로 만들기 위해 취할 조치를 결정합니다. 

## Pod Phase

파드의 `status` 필드는 `phase` 필드를 포함하는 `PodStatus` 오브젝트로 정의됩니다.

`phase`에 가능한 값은 다음과 같습니다.

- Pending : 파드가 쿠버네티스 클러스터에서 승인되었지만 하나 이상의 컨테이너가 설정되지 않았고 실행할 준비가 되지 않았다는 의미

- Running : 파드가 노드에 바인딩 되었고 모든 컨테이너가 생성되었다. 하나의 컨테이너가 아직 실행 중이거나 시작 또는 재시작 중에 있다는 의미

- Succeeded : 파드에 있는 모든 컨테이너들이 성공적으로 종료되었고 재시작 되지 않을 것이라는 의미

- Failed : 파드에 있는 모든 컨테이너가 종료되었고, 적어도 하나 이상의 컨테이너가 실패로 종료되었음을 의미

- Unknown: 어떤 이유에서든 파드의 상태를 얻을 수 없는 상태. 일반적으로 파드가 실행되어야 하는 노드와의 통신 오류로 발생

## Container 상태

쿠버네티스는 파드의 상태 뿐만 아니라 컨테이너의 상태도 추적합니다. 

- Waiting : 컨테이너 Running 또는 Terminated 상태가 아니면 Waiting 상태입니다. 

- Running : 컨테이너가 문제 없이 실행되고 있음을 나타냅니다. 

- Terminated : 종료되었음을 의미

## Cotainer Lifecycle Hooks

쿠버네티스는 컨테이너에 라이프사이클 훅을 제공합니다. 훅은 컨테이너가 관리 라이프사이클의 이벤트를 인지하고 상응하는 라이프사이클 훅이 실행될 때 핸들러에 구현된 코드를 실행 할 수 있게 합니다. 

### Container Hook

컨테이너에 노출되는 훅은 두가지가 있습니다.

`PostStart`

이 훅은 컨테이너가 생성된 직후에 실행됩니다. 그렇지만 훅이 컨테이너 엔트리포인트에 앞서서 실행된다는 보장은 없습니다. 파라미터는 핸들러에 전달되지 않습니다.

`PreStop`

이 훅은 API 요청이나 `linvenessProbe` 실패, 선점, 자원 경합등의 관리 이벤트로 컨테이너가 종료되기 직전에 호출됩니다. 컨테이너가 이미 terminated, completed 상태인 경우에는 `PreStop` 훅이 실패합니다. 

