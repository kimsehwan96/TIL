# AWS VPC

AWS VPC는 Amazon VIrtual Private Cloud 를 의미하며, 논리적으로 격리된 가상 네트워크에서 AWS 리소스를 시작 할 수 있습니다. 

## 기능

### VPC 

VPC는 자체 데이터센터에서 운영하는 기존 네트워크와 아주 유사한 가상 네트워크 입니다. VPC 를 생성한 후 서브넷을 추가 할 수 있습니다.

### 서브넷

서브넷은 VPC의 IP 주소 범위입니다. 서브넷은 단일 가용 영역에 상주해야 합니다.

### 라우팅

라우팅 테이블을 사용하여 서브넷 또는 게이트웨이의 네트워크 트래픽이 전달되는 위치를 결정합니다.

### 게이트웨이 및 엔드포인트

게이트웨이는 VPC를 다른 네트워크에 연결합니다. 예를 들면 인터넷 게이트웨이를 사용하여 VPC를 인터넷에 연결합니다. 

### 트랜짓 게이트웨이

중앙 허브 역할을 하는 트랜짓(전송)게이트웨이를 사용하여 VPC, VPN 연결 및 AWS Direct Coneect 연결 간에 트래픽을 라우팅합니다. 

## VPC 의 서브넷

서브넷은 VPC 의 IP 주소 범위입니다. 

각 서브넷은 단일 가용 영역 내에서만 존재해야 하며, 여러 영역으로 확장 할 수 없습니다. 

### 서브넷 유형

서브넷 유형은 서브넷에 대한 라우팅을 구성하는 방법에 따라 결정됩니다.

#### 퍼블릭 서브넷

서브넷에 인터넷 게이트웨이로 직접 연결되는 경로가 있씁니다. 퍼블릭 서브넷의 리소스는 퍼블릭 인터넷에 엑세스 할 수 있습니다.

#### 프라이빗 서브넷

서브넷에 인터넷 게이트웨이로 직접 연결되는 경로가 없습니다. 프라이빗 서브넷의 리소스에는 퍼블릭 인터넷에 액세스 하기 위해 NAT 디바이스가 필요합니다.

#### VPN 전용 서브넷

서브넷에 가상 프라이빗 게이트웨이를 통해 Site to Site VPN 연결으로 연결되는 경로가 있습니다. 서브넷에는 인터넷 게이트웨이에 대한 경로가 없습니다.

#### 격리된 서브넷

서브넷에 VPC 외부 대상에 대한 경로가 없습니다. 격리된 서브넷의 리소스는 동일한 VPC의 다른 리소스와만 서로 액세스 할 수 있습니다. 

### 서브넷 라우팅

각 서브넷은 서브넷 외부로 나가는 아웃바운드 트래픽에 대해 허용된 경로를 지정하는 라우팅 테이블이 있어야 합니다. 생성된 각 서브넷은 자동으로 VPC의 기본 라우팅 테이블에 연결됩니다. 

### 서브넷 보안

AWS 리소스를 보호하려면 프라이빗 서브넷을 사용하는것이 좋습니다. 배스쳔 호스트 또는 NAT디바이스를 사용하여 프라비잇 서브넷에 있는 리소스에 인터넷 액세스를 제공합니다.

보안그룹은 EC2 인스턴스와 같은 리소스에 대한 인바운드, 아웃바운드 트래픽을 허용하며, 네트워크 ACL은 서브넷 수준에서 인바운드, 아웃바운드 트래픽을 허용하거나 제어합니다. 보안그룹만으로도 사용자가 원하는 요구사항을 충족 할 수 있지만, 추가 보안 계층을 원한다면 네트워크 ACL을 사용 할 수 있습니다. 

## NAT 디바이스

NAT디바이스를 사용하여 프라이빗 서브넷의 리소스가 인터넷, 다른 VPC 또는 온프레미스 네트워크와 연결되도록 허용 할 수 있습니다. 이러한 인스턴스는 VPC 외부의 서비스와 통신 할 수 있지만 ,원치 않는 연결 요청은 받을 수 없습니다.

NAT 디바이스는 인스턴의 소스 IPv4 주소를 NAT 디바이스의 주소로 바꿉니다. 인스턴스에 응답 트래픽을 전송 할 떄 NAT 디바이스는 주소를 원래 소스 IPv4 주소로 다시 변환합니다. 

NAT 게이트웨이라는 관리형 서비스를 사용하거나 EC2 인스턴스에서 NAT 디바이스를 생성 할 수 있습니다. 

